/**
* This class handles LZW encoding
* Adapted from Jef Poskanzer's Java port by way of J. M. G. Elliott.
* @author Kevin Weiner (original Java version - kweiner@fmsware.com)
* @author Thibault Imbert (AS3 version - bytearray.org)
* @version 0.1 AS3 implementation
*/

LZWEncoder=function(){var n,t,r,i,e,o,f,u,c,a,s,v,w={},y=-1,d=12,B=5003,h=d,l=1<<d,m=[],p=[],E=B,L=0,W=!1,Z=0,g=0,x=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],M=[],b=w.LZWEncoder=function b(e,o,f,u){n=e,t=o,r=f,i=Math.max(2,u)},j=function j(n,t){M[v++]=n,v>=254&&A(t)},k=function k(n){q(E),L=a+2,W=!0,F(a,n)},q=function q(n){for(var t=0;n>t;++t)m[t]=-1},z=w.compress=function z(n,t){var r,i,e,o,w,d,B
for(c=n,W=!1,f=c,u=C(f),a=1<<n-1,s=a+1,L=a+2,v=0,o=D(),B=0,r=E;65536>r;r*=2)++B
B=8-B,d=E,q(d),F(a,t)
n:for(;(e=D())!=y;)if(r=(e<<h)+o,i=e<<B^o,m[i]!=r){if(m[i]>=0){w=d-i,0==i&&(w=1)
do if(0>(i-=w)&&(i+=d),m[i]==r){o=p[i]
continue n}while(m[i]>=0)}F(o,t),o=e,l>L?(p[i]=L++,m[i]=r):k(t)}else o=p[i]
F(o,t),F(s,t)}
w.encode=function(r){r.writeByte(i),e=n*t,o=0,z(i+1,r),r.writeByte(0)}
var A=function A(n){v>0&&(n.writeByte(v),n.writeBytes(M,0,v),v=0)},C=function C(n){return(1<<n)-1},D=function D(){if(0==e)return y;--e
var n=r[o++]
return 255&n},F=function F(n,t){for(Z&=x[g],g>0?Z|=n<<g:Z=n,g+=f;g>=8;)j(255&Z,t),Z>>=8,g-=8
if((L>u||W)&&(W?(u=C(f=c),W=!1):(++f,u=f==h?l:C(f))),n==s){for(;g>0;)j(255&Z,t),Z>>=8,g-=8
A(t)}}
return b.apply(this,arguments),w}

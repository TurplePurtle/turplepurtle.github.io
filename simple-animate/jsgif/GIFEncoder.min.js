/**
* This class lets you encode animated GIF files
* Base class :  http://www.java2s.com/Code/Java/2D-Graphics-GUI/AnimatedGifEncoder.htm
* @author Kevin Weiner (original Java version - kweiner@fmsware.com)
* @author Thibault Imbert (AS3 version - bytearray.org)
* @version 0.1 AS3 implementation
*/

GIFEncoder=function(){function t(){this.bin=[]}for(var e=0,r={};256>e;e++)r[e]=String.fromCharCode(e)
t.prototype.getData=function(){for(var t="",e=this.bin.length,n=0;e>n;n++)t+=r[this.bin[n]]
return t},t.prototype.writeByte=function(t){this.bin.push(t)},t.prototype.writeUTFBytes=function(t){for(var e=t.length,r=0;e>r;r++)this.writeByte(t.charCodeAt(r))},t.prototype.writeBytes=function(t,e,r){for(var n=r||t.length,i=e||0;n>i;i++)this.writeByte(t[i])}
var n,i,a,o,u,c,f,y,w,l={},s=null,B=-1,h=0,v=!1,d=[],p=7,g=-1,m=!1,F=!0,b=!1,E=10
l.setDelay=function(t){h=Math.round(t/10)},l.setDispose=function(t){t>=0&&(g=t)},l.setRepeat=function(t){t>=0&&(B=t)},l.setTransparent=function(t){s=t},l.addFrame=function(t,e){if(null==t||!v||null==o)throw Error("Please call start method before calling addFrame")
var r=!0
try{e?u=t:(u=t.getImageData(0,0,t.canvas.width,t.canvas.height).data,b||C(t.canvas.width,t.canvas.height)),P(),D(),F&&(A(),M(),B>=0&&G()),S(),U(),F||M(),Q(),F=!1}catch(n){r=!1}return r},l.finish=function(){if(!v)return!1
var t=!0
v=!1
try{o.writeByte(59)}catch(e){t=!1}return t}
var T=function T(){a=0,u=null,c=null,f=null,w=null,m=!1,F=!0}
l.setFrameRate=function(t){15!=t&&(h=Math.round(100/t))},l.setQuality=function(t){1>t&&(t=1),E=t}
var C=l.setSize=function C(t,e){(!v||F)&&(n=t,i=e,1>n&&(n=320),1>i&&(i=240),b=!0)}
l.start=function(){T()
var e=!0
m=!1,o=new t
try{o.writeUTFBytes("GIF89a")}catch(r){e=!1}return v=e},l.cont=function(){T()
var e=!0
return m=!1,o=new t,v=e}
var D=function D(){var t=c.length,e=t/3
f=[]
var r=new NeuQuant(c,t,E)
w=r.process()
for(var n=0,i=0;e>i;i++){var o=r.map(255&c[n++],255&c[n++],255&c[n++])
d[o]=!0,f[i]=o}c=null,y=8,p=7,null!=s&&(a=I(s))},I=function I(t){if(null==w)return-1
for(var e=(16711680&t)>>16,r=(65280&t)>>8,n=255&t,i=0,a=16777216,o=w.length,u=0;o>u;){var c=e-(255&w[u++]),f=r-(255&w[u++]),y=n-(255&w[u]),l=c*c+f*f+y*y,s=u/3
d[s]&&a>l&&(a=l,i=s),u++}return i},P=function P(){var t=n,e=i
c=[]
for(var r=u,a=0,o=0;e>o;o++)for(var f=0;t>f;f++){var y=4*o*t+4*f
c[a++]=r[y],c[a++]=r[y+1],c[a++]=r[y+2]}},S=function S(){o.writeByte(33),o.writeByte(249),o.writeByte(4)
var t,e
null==s?(t=0,e=0):(t=1,e=2),g>=0&&(e=7&g),e<<=2,o.writeByte(0|(0|e)|t),N(h),o.writeByte(a),o.writeByte(0)},U=function U(){o.writeByte(44),N(0),N(0),N(n),N(i),F?o.writeByte(0):o.writeByte(128|p)},A=function A(){N(n),N(i),o.writeByte(240|p),o.writeByte(0),o.writeByte(0)},G=function G(){o.writeByte(33),o.writeByte(255),o.writeByte(11),o.writeUTFBytes("NETSCAPE2.0"),o.writeByte(3),o.writeByte(1),N(B),o.writeByte(0)},M=function M(){o.writeBytes(w)
for(var t=768-w.length,e=0;t>e;e++)o.writeByte(0)},N=function N(t){o.writeByte(255&t),o.writeByte(255&t>>8)},Q=function Q(){var t=new LZWEncoder(n,i,f,y)
t.encode(o)}
return l.stream=function(){return o},l.setProperties=function(t,e){v=t,F=e},l}
